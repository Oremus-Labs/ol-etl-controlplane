# Non-secret keys only. Do not commit real values.
#
# Prefer in-cluster service DNS for workloads; prefer external routes for workstation configs.
#
# Common
PIPELINE_VERSION=v1
DATASET_VERSION=2025-12-23

# Prefect (port-forward when running Terraform or local dev)
PREFECT_API_URL=http://127.0.0.1:4200/api

# Postgres (prefer PG_DSN; otherwise provide parts)
PG_DSN=postgresql://USER:PASSWORD@postgres.oremuslabs.app:5432/research
POSTGRES_HOST=postgres.oremuslabs.app
POSTGRES_PORT=5432
POSTGRES_DB=research
POSTGRES_USER=
POSTGRES_PASSWORD=

# Qdrant
QDRANT_URL=https://qdrant.oremuslabs.app
QDRANT_API_KEY=
QDRANT_COLLECTION=library_chunks_v1

# Embedding
EMBEDDING_BASE_URL=https://embedding.oremuslabs.app
EMBEDDING_API_KEY=
EMBEDDING_MAX_BATCH_TEXTS=16
EMBEDDING_MAX_BATCH_CHARS=12000

# MinIO / S3
S3_ENDPOINT=https://s3.oremuslabs.app
S3_BUCKET=rag-artifacts
S3_ACCESS_KEY=
S3_SECRET_KEY=

# Calibre export (MinIO buckets mounted by Calibre-Web + Nextcloud External Storage)
# NOTE: Calibre-Web's canonical library bucket is `calibre-library` (includes metadata.db).
# The ETL writes "import bundles" to `calibre-inbox` and can (optionally) trigger the in-cluster
# calibre-importer service to import them into the Calibre library automatically.
CALIBRE_EXPORT_ENABLED=true
CALIBRE_S3_BUCKET=calibre-inbox
CALIBRE_S3_PREFIX=etl
CALIBRE_IMPORT_ENABLED=true
CALIBRE_IMPORTER_URL=http://calibre-importer.calibre-web.svc.cluster.local:8091
CALIBRE_IMPORTER_API_KEY=
CALIBRE_IMPORT_TIMEOUT_S=60

# Nextcloud WebDAV
NEXTCLOUD_WEBDAV_URL=https://nextcloud.oremuslabs.app/remote.php/dav/files/etl-bot/
NEXTCLOUD_USER=etl-bot
NEXTCLOUD_APP_PASSWORD=
NEXTCLOUD_INGEST_PATH=ETL/Ingest

# NATS (in-cluster default; do not expose 4222 publicly without auth)
NATS_URL=nats://nats.nats.svc.cluster.local:4222
NATS_SUBJECT=docs.discovered

# Phase 3 tuning (optional)
NEXTCLOUD_MAX_FILES=25
NEWADVENT_SEED_URLS=https://www.newadvent.org/fathers/0101.htm,https://www.newadvent.org/fathers/0102.htm
NEWADVENT_WEB_MAX_PAGES=25
VATICAN_SQLITE_MAX_ROWS=25
NEWADVENT_ZIP_MAX_ENTRIES=50

# Phase 4 validation (optional)
EXTRACT_MIN_CHARS=200
EXTRACT_MIN_ALPHA_RATIO=0.15

# Phase 5 chunking / embedding request sizing (optional)
CHUNK_MAX_TOKENS=500
CHUNK_OVERLAP_TOKENS=50

# Phase 6 OCR (optional)
LLM_SERVICE_URL=https://ai.oremuslabs.app
LLM_SERVICE_API_KEY=
OCR_ENGINES=mineru,monkeyocr_pro,qwen3_vl
OCR_PDF_DPI=200
OCR_PDF_MAX_PAGES=
OCR_MIN_CHARS_PER_PAGE=40
OCR_MIN_ALPHA_RATIO=0.10
OCR_MIN_PRINTABLE_RATIO=0.85

# VPN safety/rotation (Gluetun sidecar)
GLUETUN_CONTROL_URL=http://127.0.0.1:8000
GLUETUN_API_KEY=
VPN_REQUIRED=true
VPN_ROTATE_EVERY_N_REQUESTS=10
VPN_ENSURE_TIMEOUT_S=90
VPN_ROTATE_COOLDOWN_S=2

# Phase 7 evaluation (optional)
# Example:
# EVAL_QUERIES_JSON='[{"query":"Augustine confession","expected_document_ids":["doc-123"]}]'
EVAL_QUERIES_JSON=
